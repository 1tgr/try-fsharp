function(newDoc, oldDoc, userCtx) {
    if (newDoc.type == "session") {
        if ((newDoc.initNames || []).length != (newDoc.initTexts || []).length) {
            throw { forbidden: "initNames and initTexts must have the same length" };
        }
    } else if (newDoc.type) {
        throw { forbidden: "unrecognised type" };
    } else {
        if (newDoc.messageType == "in") {
            if (newDoc.sessionId === undefined) {
                throw { forbidden: "sessionId must be set" };
            }

            if (newDoc.message === undefined) {
                throw { forbidden: "message must be set" };
            }
        } else if (newDoc.messageType == "out") {
        } else if (newDoc.messageType) {
            throw { forbidden: "unrecognised messageType" };
        } else {
            throw { forbidden: "type or messageType must be set" };
        }
    }
}
